<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VittCott ‚Äî Home</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js" defer></script>
  <link rel="stylesheet" href="/assets/css/styles.css">
  <script src="/assets/js/config.js"></script>
</head>
<body class="bg-gray-900 text-gray-100 font-sans">
  <!-- Header -->
  <nav class="bg-gray-800 sticky top-0 z-40">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <i data-feather="trending-up" class="text-indigo-500"></i>
        <a href="index.html" class="text-xl font-bold">VittCott</a>
        <div class="hidden sm:flex gap-4 ml-6 text-gray-300">
          <a href="index.html">Home</a>
          <a href="/pages/stocks.html">Stocks</a>
          <a href="/pages/mutual-funds.html">MF</a>
          <a href="/pages/create-account.html">Create Account</a>
        </div>
      </div>
      <div class="flex items-center gap-3" id="auth-section">
        <!-- header assistant button (opens modal) -->
        <button id="open-ai-btn" class="px-3 py-2 bg-indigo-600 rounded">Assistant</button>
        <!-- Upload Portfolio button -->
        <button id="open-upload-btn" class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded">Upload Portfolio</button>
        <!-- Logged out state (default) -->
        <div id="logged-out-btns">
          <a href="http://localhost:3000/pages/create-account.html" class="px-3 py-2 bg-indigo-500 rounded">Login / Signup</a>
        </div>
        <!-- Logged in state (hidden by default) -->
        <div id="logged-in-section" class="hidden flex items-center gap-3">
          <span id="welcome-text" class="text-gray-300"></span>
          <button id="logout-btn" class="px-3 py-2 bg-red-500 hover:bg-red-600 rounded">Logout</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <header class="gradient-bg py-12">
    <div class="max-w-6xl mx-auto px-4 grid lg:grid-cols-2 gap-8 items-center">
      <div>
        <h1 class="text-4xl sm:text-5xl font-extrabold">Invest in your future with confidence</h1>
        <p class="mt-4 text-indigo-100">VittCott makes investing simple, accessible and student friendly.</p>
        <div class="mt-6 flex gap-3">
          <a href="/pages/create-account.html" class="px-5 py-3 bg-white text-indigo-600 rounded font-semibold">Get Started</a>
          
        </div>

        <div class="mt-6 grid grid-cols-2 gap-2">
          <button onclick="openAssistantWithPrompt('Suggest a beginner SIP plan')" class="px-3 py-2 bg-indigo-800/40 rounded">Ask: SIP plan</button>
          <button onclick="openAssistantWithPrompt('Top 5 long-term stocks in India')" class="px-3 py-2 bg-indigo-800/40 rounded">Ask: Stocks</button>
        </div>
      </div>
      <div>
        <img src="/assets/images/hero-placeholder.jpg" alt="Hero" class="rounded shadow-lg w-full object-cover">
      </div>
    </div>
  </header>

  <!-- Ticker -->
  <section class="bg-gray-800 py-3">
    <div class="max-w-6xl mx-auto px-4 flex items-center gap-6 overflow-hidden">
      <div class="font-bold">Live Markets:</div>
      <div class="ticker-tape flex gap-8 whitespace-nowrap">
        <div class="flex gap-2"><span class="text-green-400">NIFTY</span> 18,245 <span class="text-green-400">+124</span></div>
        <div class="flex gap-2"><span class="text-red-400">SENSEX</span> 61,420 <span class="text-red-400">-85</span></div>
        <div class="flex gap-2"><span class="text-green-400">GOLD</span> ‚Çπ5,245 <span class="text-green-400">+45</span></div>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section class="py-12 bg-gray-800">
    <div class="max-w-6xl mx-auto px-4 text-center mb-8">
      <h2 class="text-3xl font-bold">Why choose VittCott?</h2>
      <p class="text-gray-400">Student-focused tools + AI assistant for easier investing.</p>
    </div>
    <div class="max-w-6xl mx-auto px-4 grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <div class="bg-gray-700 p-6 rounded card-hover">
        <div class="h-12 w-12 bg-indigo-500 rounded flex items-center justify-center text-white"><i data-feather="zap"></i></div>
        <h3 class="mt-4 font-semibold">Zero Commission</h3>
        <p class="text-gray-300">Trade with zero commission fees.</p>
      </div>
      <div class="bg-gray-50 text-gray-900 p-6 rounded card-hover">
        <div class="h-12 w-12 bg-green-500 rounded flex items-center justify-center text-white"><i data-feather="shield"></i></div>
        <h3 class="mt-4 font-semibold">Safe & Secure</h3>
        <p class="text-gray-700">Bank-level security.</p>
      </div>
      <div class="bg-gray-50 text-gray-900 p-6 rounded card-hover">
        <div class="h-12 w-12 bg-blue-500 rounded flex items-center justify-center text-white"><i data-feather="pie-chart"></i></div>
        <h3 class="mt-4 font-semibold">Smart Portfolio</h3>
        <p class="text-gray-700">AI-powered portfolio suggestions.</p>
      </div>
    </div>
  </section>

  <!-- Stocks preview -->
  <section id="stocks" class="py-12 bg-gray-800">
    <div class="max-w-6xl mx-auto px-4">
      <h2 class="text-2xl font-bold mb-4">Popular Stocks</h2>
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="bg-gray-700 p-4 rounded"><strong>RELI</strong><div class="text-sm text-gray-400">Reliance ‚Äî ‚Çπ2350</div></div>
        <div class="bg-gray-700 p-4 rounded"><strong>TCS</strong><div class="text-sm text-gray-400">TCS ‚Äî ‚Çπ3200</div></div>
        <div class="bg-gray-700 p-4 rounded"><strong>INFY</strong><div class="text-sm text-gray-400">Infosys ‚Äî ‚Çπ1400</div></div>
        <div class="bg-gray-700 p-4 rounded"><strong>HDFC</strong><div class="text-sm text-gray-400">HDFC ‚Äî ‚Çπ2600</div></div>
      </div>
      <div class="mt-4"><a href="/pages/stocks.html" class="text-indigo-400">View all stocks ‚Üí</a></div>
    </div>
  </section>

  <!-- CTA -->
  <section class="py-12 bg-gray-900">
    <div class="max-w-6xl mx-auto px-4 bg-gray-800 rounded p-6 grid lg:grid-cols-2 gap-4 items-center">
      <div>
        <h3 class="text-2xl font-bold">Ready to start investing?</h3>
        <p class="text-gray-400">Join VittCott and use the assistant to plan your investments.</p>
      </div>
      <div class="text-right">
        <a href="/pages/create-account.html" class="px-4 py-2 bg-indigo-600 rounded">Create Free Account</a>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-950 text-gray-300 py-8">
    <div class="max-w-6xl mx-auto px-4">
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <div>
          <h4 class="font-semibold text-gray-400">Products</h4>
          <ul class="mt-2 space-y-2"><li><a href="/pages/stocks.html">Stocks</a></li><li><a href="/pages/mutual-funds.html">Mutual Funds</a></li></ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-400">Company</h4>
          <ul class="mt-2 space-y-2"><li>About</li><li>Careers</li></ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-400">Support</h4>
          <ul class="mt-2 space-y-2"><li>Help</li><li>Contact</li></ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-400">Connect</h4>
          <div class="mt-2">Socials</div>
        </div>
      </div>
      <div class="mt-8 text-center text-sm text-gray-500">¬© <span id="year">2025</span> VittCott</div>
    </div>
  </footer>

  <!-- Floating assistant button -->
  <button id="float-open" class="fixed right-6 bottom-6 z-50 px-4 py-3 bg-indigo-600 rounded-full shadow-lg">Assistant</button>

  <!-- Upload Portfolio Widget (hidden by default) -->
  <div id="upload-widget" style="display:none; position:fixed; right:20px; bottom:90px; z-index:60; background:rgba(17,24,39,0.95); padding:18px; border-radius:10px; width:320px; box-shadow:0 10px 30px rgba(0,0,0,0.6);">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
      <strong style="color:#E6EEF8">Upload Portfolio</strong>
      <button id="close-upload" style="background:transparent; color:#cbd5e1; border:none; font-size:16px; cursor:pointer;">‚úï</button>
    </div>
    <input id="uc-username" placeholder="username" style="width:100%; padding:8px; margin-bottom:8px; border-radius:6px; border:1px solid #374151; background:#0f1724; color:#e5e7eb" value="" />
    <input id="uc-file" type="file" accept=".xlsx,.xls" style="width:100%; margin-bottom:8px; color:#e5e7eb" />
    <div style="display:flex; gap:8px;">
      <button id="uc-uploadBtn" style="flex:1; padding:8px; background:#10B981; color:white; border-radius:6px; border:none; cursor:pointer; font-weight:600;">Upload</button>
      <button id="uc-clearBtn" style="padding:8px; background:#374151; color:#e5e7eb; border-radius:6px; border:none; cursor:pointer;">Clear</button>
    </div>
    <progress id="uc-progress" value="0" max="100" style="width:100%; margin-top:8px; display:none"></progress>
    <div id="uc-status" style="color:#cbd5e1; margin-top:8px; font-size:13px;"></div>
  </div>

  <!-- Assistant modal / iframe (hidden until opened) -->
  <!-- Configure ASSISTANT_URL by setting window.VITTCOTT_ASSISTANT_URL before config.js loads,
       or modify getAssistantUrl() in config.js. Options: '/assistant/', 'https://assistant.example.com', 'http://localhost:8501' -->
    <!-- Assistant now opens in a full browser tab at ASSISTANT_URL -->

  <!-- Shared scripts -->
  <script>
    // Use shared config utility for assistant URL
    // Can be overridden by setting window.VITTCOTT_ASSISTANT_URL before config.js loads
    const ASSISTANT_URL = window.VittCottConfig ? window.VittCottConfig.getAssistantUrl() : 'http://localhost:8501';

    // Elements
    const openHeaderBtn = document.getElementById('open-ai-btn');
    const floatOpenBtn = document.getElementById('float-open');

    // Open the assistant in a full browser tab (with optional prompt query param)
    function openAssistant(promptText = '') {
      let url = ASSISTANT_URL;
      if (promptText) {
        const sep = url.includes('?') ? '&' : '?';
        url = url + sep + 'prompt=' + encodeURIComponent(promptText);
      }
      // open in new tab to avoid iframe embedding issues
      window.open(url, '_blank');
    }

    // convenience: open and inject a prompt
    function openAssistantWithPrompt(promptText='') {
      openAssistant(promptText);
    }

    // wire UI: header and floating buttons open the assistant in a new tab
    if (openHeaderBtn) openHeaderBtn.addEventListener('click', () => openAssistant());
    if (floatOpenBtn) floatOpenBtn.addEventListener('click', () => openAssistant());

    // init feather + AOS + year text after DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
      if (window.feather) feather.replace();
      if (window.AOS) AOS.init({duration:700});
      document.getElementById('year').textContent = new Date().getFullYear();
      
      // Check if user is logged in
      checkAuthStatus();
    });

    // Check authentication status and update UI
    function checkAuthStatus() {
      const token = localStorage.getItem('vittcott_token');
      const userStr = localStorage.getItem('vittcott_user');
      
      const loggedOutBtns = document.getElementById('logged-out-btns');
      const loggedInSection = document.getElementById('logged-in-section');
      const welcomeText = document.getElementById('welcome-text');
      const logoutBtn = document.getElementById('logout-btn');
      
      if (token && userStr) {
        try {
          const user = JSON.parse(userStr);
          const displayName = user.displayName || user.email.split('@')[0];
          
          // Show logged in state
          loggedOutBtns.classList.add('hidden');
          loggedInSection.classList.remove('hidden');
          welcomeText.textContent = `Welcome, ${displayName}!`;
          
          // Wire logout button
          logoutBtn.addEventListener('click', logout);
        } catch (e) {
          console.error('Failed to parse user data:', e);
          showLoggedOut();
        }
      } else {
        showLoggedOut();
      }
    }

    function showLoggedOut() {
      const loggedOutBtns = document.getElementById('logged-out-btns');
      const loggedInSection = document.getElementById('logged-in-section');
      
      loggedOutBtns.classList.remove('hidden');
      loggedInSection.classList.add('hidden');
    }

    function logout() {
      localStorage.removeItem('vittcott_token');
      localStorage.removeItem('vittcott_user');
      alert('Logged out successfully!');
      showLoggedOut();
    }

    // ===== Upload Portfolio Widget Logic =====
    const PRESIGN_URL = 'http://localhost:8000/presign';
    const REGISTER_URL = 'http://localhost:8000/register';

    const openUploadBtn = document.getElementById('open-upload-btn');
    const closeUploadBtn = document.getElementById('close-upload');
    const uploadWidget = document.getElementById('upload-widget');
    const ucUsername = document.getElementById('uc-username');
    const ucFile = document.getElementById('uc-file');
    const ucUploadBtn = document.getElementById('uc-uploadBtn');
    const ucClearBtn = document.getElementById('uc-clearBtn');
    const ucProgress = document.getElementById('uc-progress');
    const ucStatus = document.getElementById('uc-status');

    // Open upload widget
    if (openUploadBtn) {
      openUploadBtn.addEventListener('click', () => {
        uploadWidget.style.display = 'block';
        // Pre-fill username if logged in
        const token = localStorage.getItem('vittcott_token');
        const userStr = localStorage.getItem('vittcott_user');
        if (token && userStr) {
          try {
            const user = JSON.parse(userStr);
            ucUsername.value = user.email.split('@')[0];
          } catch (e) {
            ucUsername.value = '';
          }
        }
      });
    }

    // Close upload widget
    if (closeUploadBtn) {
      closeUploadBtn.addEventListener('click', () => {
        uploadWidget.style.display = 'none';
      });
    }

    // Clear form
    if (ucClearBtn) {
      ucClearBtn.addEventListener('click', () => {
        ucFile.value = '';
        ucProgress.style.display = 'none';
        ucProgress.value = 0;
        ucStatus.textContent = '';
      });
    }

    // Upload file to S3
    if (ucUploadBtn) {
      ucUploadBtn.addEventListener('click', async () => {
        const username = ucUsername.value.trim();
        const file = ucFile.files[0];

        if (!username) {
          ucStatus.textContent = '‚ùå Please enter username';
          ucStatus.style.color = '#ef4444';
          return;
        }
        if (!file) {
          ucStatus.textContent = '‚ùå Please select a file';
          ucStatus.style.color = '#ef4444';
          return;
        }

        try {
          ucStatus.textContent = 'üîÑ Getting presigned URL...';
          ucStatus.style.color = '#cbd5e1';
          ucProgress.style.display = 'block';
          ucProgress.value = 10;

          // Step 1: Get presigned POST from backend
          const presignRes = await fetch(PRESIGN_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              filename: file.name,
              content_type: file.type || 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
              username: username
            })
          });

          if (!presignRes.ok) {
            throw new Error(`Presign failed: ${presignRes.status}`);
          }

          const presignData = await presignRes.json();
          ucProgress.value = 30;
          ucStatus.textContent = '‚òÅÔ∏è Uploading to S3...';

          // Step 2: Upload file to S3 using presigned POST
          const formData = new FormData();
          Object.entries(presignData.fields).forEach(([key, value]) => {
            formData.append(key, value);
          });
          formData.append('file', file);

          const s3Res = await fetch(presignData.url, {
            method: 'POST',
            body: formData
          });

          if (s3Res.status !== 204 && !s3Res.ok) {
            throw new Error(`S3 upload failed: ${s3Res.status}`);
          }

          ucProgress.value = 70;
          ucStatus.textContent = 'üìù Registering file...';

          // Step 3: Register file in backend
          const registerRes = await fetch(REGISTER_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              username: username,
              s3_key: presignData.key,
              filename: file.name,
              size: file.size
            })
          });

          if (!registerRes.ok) {
            console.warn('Registration failed but file uploaded to S3');
          }

          ucProgress.value = 100;
          ucStatus.textContent = '‚úÖ Upload successful!';
          ucStatus.style.color = '#10b981';

          // Clear after 3 seconds
          setTimeout(() => {
            ucFile.value = '';
            ucProgress.style.display = 'none';
            ucProgress.value = 0;
            ucStatus.textContent = '';
          }, 3000);

        } catch (err) {
          console.error('Upload error:', err);
          ucStatus.textContent = `‚ùå Upload failed: ${err.message}`;
          ucStatus.style.color = '#ef4444';
          ucProgress.style.display = 'none';
        }
      });
    }
  </script>

  <script src="/assets/js/app.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
</body>
</html>
<button id="open-upload-btn" class="px-3 py-2 bg-green-600 rounded">Upload Portfolio</button>

<!-- Upload widget (hidden by default) -->
<div id="upload-widget" style="display:none; position:fixed; right:20px; bottom:90px; z-index:60; background:rgba(17,24,39,0.95); padding:18px; border-radius:10px; width:320px; box-shadow:0 10px 30px rgba(0,0,0,0.6);">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
    <strong style="color:#E6EEF8">Upload Portfolio</strong>
    <button id="close-upload" style="background:transparent; color:#cbd5e1; border:none; font-size:16px;">‚úï</button>
  </div>

  <input id="uc-username" placeholder="username" style="width:100%; padding:8px; margin-bottom:8px; border-radius:6px; border:1px solid #374151; background:#0f1724; color:#e5e7eb" value="testuser" />
  <input id="uc-file" type="file" accept=".xlsx,.xls" style="width:100%; margin-bottom:8px; color:#e5e7eb" />
  <div style="display:flex; gap:8px;">
    <button id="uc-uploadBtn" style="flex:1; padding:8px; background:#10B981; color:white; border-radius:6px; border:none;">Upload</button>
    <button id="uc-clearBtn" style="padding:8px; background:#374151; color:#e5e7eb; border-radius:6px; border:none;">Clear</button>
  </div>

  <progress id="uc-progress" value="0" max="100" style="width:100%; margin-top:8px; display:none"></progress>
  <div id="uc-status" style="color:#cbd5e1; margin-top:8px; font-size:13px;"></div>
</div>
