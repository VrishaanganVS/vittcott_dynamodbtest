<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VittCott ‚Äî Home</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js" defer></script>
  <link rel="stylesheet" href="/assets/css/styles.css">
  <script src="/assets/js/config.js"></script>
  <style>
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
    @keyframes shimmer { 0% { background-position: -1000px 0; } 100% { background-position: 1000px 0; } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    .float-animation { animation: float 6s ease-in-out infinite; }
    .shimmer { animation: shimmer 3s infinite; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); background-size: 1000px 100%; }
    .glass { background: rgba(17, 24, 39, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
    .card-hover { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
    .card-hover:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 20px 40px rgba(99, 102, 241, 0.3); }
    .btn-modern { position: relative; overflow: hidden; transition: all 0.3s ease; }
    .btn-modern::before { content: ''; position: absolute; top: 50%; left: 50%; width: 0; height: 0; border-radius: 50%; background: rgba(255,255,255,0.2); transform: translate(-50%, -50%); transition: width 0.6s, height 0.6s; }
    .btn-modern:hover::before { width: 300px; height: 300px; }
    .gradient-text { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans">
  <!-- Header -->
  <nav class="glass sticky top-0 z-50 shadow-2xl">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <i data-feather="trending-up" class="text-indigo-400 w-7 h-7"></i>
        <a href="index.html" class="text-2xl font-bold gradient-text">VittCott</a>
        <div class="hidden sm:flex gap-6 ml-8 text-gray-300">
          <a href="index.html" class="hover:text-indigo-400 transition-all duration-300 font-medium">Home</a>
          <a href="/pages/stocks.html" class="hover:text-indigo-400 transition-all duration-300 font-medium">Stocks</a>
          <a href="/pages/mutual-funds.html" class="hover:text-indigo-400 transition-all duration-300 font-medium">Mutual Funds</a>
          <a href="/pages/create-account.html" class="hover:text-indigo-400 transition-all duration-300 font-medium">Sign Up</a>
        </div>
      </div>
      <div class="flex items-center gap-2" id="auth-section">
        <!-- header assistant button (opens modal) -->
        <button id="open-ai-btn" class="btn-modern px-4 py-2.5 bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 rounded-xl font-semibold shadow-lg hover:shadow-indigo-500/50 transition-all duration-300">‚ú® Assistant</button>
        <!-- Upload Portfolio button -->
        <button id="open-upload-btn" class="btn-modern px-4 py-2.5 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 rounded-xl font-semibold shadow-lg hover:shadow-green-500/50 transition-all duration-300">üìä Upload</button>
        <!-- Logged out state (default) -->
        <div id="logged-out-btns">
          <a href="http://localhost:3000/pages/create-account.html" class="btn-modern px-4 py-2.5 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl font-semibold shadow-lg hover:shadow-purple-500/50 transition-all duration-300">Get Started</a>
        </div>
        <!-- Logged in state (hidden by default) -->
        <div id="logged-in-section" class="hidden flex items-center gap-3">
          <span id="welcome-text" class="text-gray-300 font-medium"></span>
          <button id="logout-btn" class="btn-modern px-4 py-2.5 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 rounded-xl font-semibold shadow-lg hover:shadow-red-500/50 transition-all duration-300">Logout</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <header class="relative overflow-hidden bg-gradient-to-br from-gray-900 via-indigo-900/30 to-purple-900/20 py-20">
    <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0dGVybiBpZD0iZ3JpZCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBwYXR0ZXJuVW5pdHM9InVzZXJTcGFjZU9uVXNlIj48cGF0aCBkPSJNIDQwIDAgTCAwIDAgMCA0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2JhKDk5LCAxMDIsIDI0MSwgMC4xKSIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIi8+PC9zdmc+')] opacity-20"></div>
    <div class="max-w-6xl mx-auto px-4 grid lg:grid-cols-2 gap-12 items-center relative z-10">
      <div class="space-y-6" style="animation: slideUp 0.8s ease-out">
        <h1 class="text-5xl sm:text-6xl font-extrabold leading-tight">
          <span class="bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">Invest in your future</span>
          <br/><span class="text-white">with confidence</span>
        </h1>
        <p class="text-xl text-gray-300 leading-relaxed">VittCott makes investing simple, accessible and student friendly. Start your financial journey today with AI-powered insights.</p>
        <div class="flex flex-wrap gap-4">
          <a href="/pages/create-account.html" class="btn-modern px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 rounded-2xl font-bold text-lg shadow-2xl hover:shadow-indigo-500/50 transition-all duration-300 transform hover:scale-105">Get Started Free ‚Üí</a>
          <a href="/pages/stocks.html" class="btn-modern px-8 py-4 glass hover:bg-white/10 rounded-2xl font-bold text-lg shadow-xl transition-all duration-300 transform hover:scale-105">Explore Markets</a>
        </div>

        <div class="grid grid-cols-2 gap-3 pt-4">
          <button onclick="openAssistantWithPrompt('Suggest a beginner SIP plan')" class="glass px-4 py-3 rounded-xl hover:bg-indigo-600/20 transition-all duration-300 text-left group">
            <span class="text-indigo-400 group-hover:text-indigo-300 font-semibold">üí° Ask AI:</span>
            <div class="text-sm text-gray-400 group-hover:text-gray-300">SIP Investment Plan</div>
          </button>
          <button onclick="openAssistantWithPrompt('Top 5 long-term stocks in India')" class="glass px-4 py-3 rounded-xl hover:bg-purple-600/20 transition-all duration-300 text-left group">
            <span class="text-purple-400 group-hover:text-purple-300 font-semibold">üìà Ask AI:</span>
            <div class="text-sm text-gray-400 group-hover:text-gray-300">Best Long-Term Stocks</div>
          </button>
        </div>
      </div>
      <div class="float-animation hidden lg:block">
        <div class="glass rounded-3xl p-8 shadow-2xl">
          <img src="/assets/images/hero-placeholder.jpg" alt="Investment Dashboard" class="rounded-2xl shadow-xl w-full object-cover">
          <div class="mt-6 grid grid-cols-3 gap-4 text-center">
            <div class="glass p-4 rounded-xl">
              <div class="text-2xl font-bold text-green-400">‚Çπ10L+</div>
              <div class="text-xs text-gray-400 mt-1">Investments</div>
            </div>
            <div class="glass p-4 rounded-xl">
              <div class="text-2xl font-bold text-blue-400">5K+</div>
              <div class="text-xs text-gray-400 mt-1">Users</div>
            </div>
            <div class="glass p-4 rounded-xl">
              <div class="text-2xl font-bold text-purple-400">24/7</div>
              <div class="text-xs text-gray-400 mt-1">AI Support</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Ticker -->
  <section class="glass border-t border-b border-gray-700/50 py-4">
    <div class="max-w-6xl mx-auto px-4 flex items-center gap-8 overflow-hidden">
      <div class="font-bold text-indigo-400 flex items-center gap-2">
        <span class="inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
        Live Markets
      </div>
      <div class="ticker-tape flex gap-8 whitespace-nowrap">
        <div class="glass px-4 py-2 rounded-lg flex items-center gap-2"><span class="text-green-400 font-bold">NIFTY 50</span> <span class="text-white">18,245</span> <span class="text-green-400 font-semibold">+124 ‚ñ≤</span></div>
        <div class="glass px-4 py-2 rounded-lg flex items-center gap-2"><span class="text-red-400 font-bold">SENSEX</span> <span class="text-white">61,420</span> <span class="text-red-400 font-semibold">-85 ‚ñº</span></div>
        <div class="glass px-4 py-2 rounded-lg flex items-center gap-2"><span class="text-yellow-400 font-bold">GOLD</span> <span class="text-white">‚Çπ5,245</span> <span class="text-green-400 font-semibold">+45 ‚ñ≤</span></div>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section class="py-20 bg-gradient-to-b from-gray-900 to-gray-800">
    <div class="max-w-6xl mx-auto px-4 text-center mb-12">
      <h2 class="text-4xl font-bold mb-4">
        <span class="bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">Why choose VittCott?</span>
      </h2>
      <p class="text-xl text-gray-400">Student-focused tools + AI assistant for smarter investing</p>
    </div>
    <div class="max-w-6xl mx-auto px-4 grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
      <div class="glass p-8 rounded-3xl card-hover group">
        <div class="h-16 w-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-indigo-500/50 group-hover:shadow-indigo-500/80 transition-all duration-300 group-hover:scale-110">
          <i data-feather="zap" class="w-8 h-8"></i>
        </div>
        <h3 class="mt-6 text-xl font-bold text-white">Zero Commission</h3>
        <p class="mt-3 text-gray-400 leading-relaxed">Trade stocks and mutual funds with absolutely zero commission fees. Keep more of your profits.</p>
      </div>
      <div class="glass p-8 rounded-3xl card-hover group">
        <div class="h-16 w-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-green-500/50 group-hover:shadow-green-500/80 transition-all duration-300 group-hover:scale-110">
          <i data-feather="shield" class="w-8 h-8"></i>
        </div>
        <h3 class="mt-6 text-xl font-bold text-white">Safe & Secure</h3>
        <p class="mt-3 text-gray-400 leading-relaxed">Bank-level security with 256-bit encryption. Your data and investments are always protected.</p>
      </div>
      <div class="glass p-8 rounded-3xl card-hover group">
        <div class="h-16 w-16 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-500/50 group-hover:shadow-blue-500/80 transition-all duration-300 group-hover:scale-110">
          <i data-feather="pie-chart" class="w-8 h-8"></i>
        </div>
        <h3 class="mt-6 text-xl font-bold text-white">Smart Portfolio</h3>
        <p class="mt-3 text-gray-400 leading-relaxed">AI-powered portfolio suggestions and real-time analytics to optimize your investments.</p>
      </div>
    </div>
  </section>

  <!-- Stocks preview -->
  <section id="stocks" class="py-20 bg-gray-900">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex justify-between items-center mb-8">
        <h2 class="text-3xl font-bold bg-gradient-to-r from-green-400 to-blue-400 bg-clip-text text-transparent">Trending Stocks</h2>
        <a href="/pages/stocks.html" class="btn-modern px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 rounded-xl font-semibold shadow-lg transition-all duration-300">View All Stocks ‚Üí</a>
      </div>
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="glass p-6 rounded-2xl card-hover">
          <div class="flex justify-between items-start mb-3">
            <strong class="text-2xl font-bold text-white">RELIANCE</strong>
            <span class="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded-lg font-semibold">+2.5%</span>
          </div>
          <div class="text-sm text-gray-400 mb-2">Reliance Industries</div>
          <div class="text-3xl font-bold text-green-400">‚Çπ2,350</div>
        </div>
        <div class="glass p-6 rounded-2xl card-hover">
          <div class="flex justify-between items-start mb-3">
            <strong class="text-2xl font-bold text-white">TCS</strong>
            <span class="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded-lg font-semibold">+1.8%</span>
          </div>
          <div class="text-sm text-gray-400 mb-2">Tata Consultancy</div>
          <div class="text-3xl font-bold text-green-400">‚Çπ3,200</div>
        </div>
        <div class="glass p-6 rounded-2xl card-hover">
          <div class="flex justify-between items-start mb-3">
            <strong class="text-2xl font-bold text-white">INFY</strong>
            <span class="text-xs bg-red-500/20 text-red-400 px-2 py-1 rounded-lg font-semibold">-0.5%</span>
          </div>
          <div class="text-sm text-gray-400 mb-2">Infosys Limited</div>
          <div class="text-3xl font-bold text-red-400">‚Çπ1,400</div>
        </div>
        <div class="glass p-6 rounded-2xl card-hover">
          <div class="flex justify-between items-start mb-3">
            <strong class="text-2xl font-bold text-white">HDFC</strong>
            <span class="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded-lg font-semibold">+3.2%</span>
          </div>
          <div class="text-sm text-gray-400 mb-2">HDFC Bank</div>
          <div class="text-3xl font-bold text-green-400">‚Çπ2,600</div>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="py-20 bg-gradient-to-b from-gray-800 to-gray-900">
    <div class="max-w-6xl mx-auto px-4">
      <div class="glass rounded-3xl p-12 grid lg:grid-cols-2 gap-8 items-center shadow-2xl border-2 border-indigo-500/20">
        <div>
          <h3 class="text-4xl font-bold mb-4">
            <span class="bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">Ready to start investing?</span>
          </h3>
          <p class="text-xl text-gray-300 leading-relaxed">Join thousands of students building wealth with VittCott. Get AI-powered insights, zero commission trading, and real-time market data.</p>
          <div class="mt-6 flex items-center gap-4 text-sm text-gray-400">
            <div class="flex items-center gap-2">
              <i data-feather="check-circle" class="text-green-400 w-5 h-5"></i>
              <span>No Hidden Fees</span>
            </div>
            <div class="flex items-center gap-2">
              <i data-feather="check-circle" class="text-green-400 w-5 h-5"></i>
              <span>AI Assistant</span>
            </div>
            <div class="flex items-center gap-2">
              <i data-feather="check-circle" class="text-green-400 w-5 h-5"></i>
              <span>Real-time Data</span>
            </div>
          </div>
        </div>
        <div class="text-right">
          <a href="/pages/create-account.html" class="btn-modern inline-block px-10 py-5 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 rounded-2xl font-bold text-xl shadow-2xl hover:shadow-indigo-500/50 transition-all duration-300 transform hover:scale-105">Create Free Account ‚Üí</a>
          <p class="mt-4 text-sm text-gray-400">Get started in less than 2 minutes</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-950 text-gray-300 py-8">
    <div class="max-w-6xl mx-auto px-4">
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <div>
          <h4 class="font-semibold text-gray-400">Products</h4>
          <ul class="mt-2 space-y-2"><li><a href="/pages/stocks.html">Stocks</a></li><li><a href="/pages/mutual-funds.html">Mutual Funds</a></li></ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-400">Company</h4>
          <ul class="mt-2 space-y-2"><li>About</li><li>Careers</li></ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-400">Support</h4>
          <ul class="mt-2 space-y-2"><li>Help</li><li>Contact</li></ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-400">Connect</h4>
          <div class="mt-2">Socials</div>
        </div>
      </div>
      <div class="mt-8 text-center text-sm text-gray-500">¬© <span id="year">2025</span> VittCott</div>
    </div>
  </footer>

  <!-- Floating assistant button -->
  <button id="float-open" class="fixed right-6 bottom-6 z-50 px-4 py-3 bg-indigo-600 rounded-full shadow-lg">Assistant</button>

  <!-- Upload Portfolio Widget (hidden by default) -->
  <div id="upload-widget" style="display:none; position:fixed; right:20px; bottom:90px; z-index:60; background:rgba(17,24,39,0.95); padding:18px; border-radius:10px; width:320px; box-shadow:0 10px 30px rgba(0,0,0,0.6);">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
      <strong style="color:#E6EEF8">Upload Portfolio</strong>
      <button id="close-upload" style="background:transparent; color:#cbd5e1; border:none; font-size:16px; cursor:pointer;">‚úï</button>
    </div>
    <input id="uc-username" placeholder="username" style="width:100%; padding:8px; margin-bottom:8px; border-radius:6px; border:1px solid #374151; background:#0f1724; color:#e5e7eb" value="" />
    <input id="uc-file" type="file" accept=".xlsx,.xls" style="width:100%; margin-bottom:8px; color:#e5e7eb" />
    <div style="display:flex; gap:8px;">
      <button id="uc-uploadBtn" style="flex:1; padding:8px; background:#10B981; color:white; border-radius:6px; border:none; cursor:pointer; font-weight:600;">Upload</button>
      <button id="uc-clearBtn" style="padding:8px; background:#374151; color:#e5e7eb; border-radius:6px; border:none; cursor:pointer;">Clear</button>
    </div>
    <progress id="uc-progress" value="0" max="100" style="width:100%; margin-top:8px; display:none"></progress>
    <div id="uc-status" style="color:#cbd5e1; margin-top:8px; font-size:13px;"></div>
  </div>

  <!-- Assistant modal / iframe (hidden until opened) -->
  <!-- Configure ASSISTANT_URL by setting window.VITTCOTT_ASSISTANT_URL before config.js loads,
       or modify getAssistantUrl() in config.js. Options: '/assistant/', 'https://assistant.example.com', 'http://localhost:8501' -->
    <!-- Assistant now opens in a full browser tab at ASSISTANT_URL -->

  <!-- Shared scripts -->
  <script>
    // Use shared config utility for assistant URL
    // Can be overridden by setting window.VITTCOTT_ASSISTANT_URL before config.js loads
    const ASSISTANT_URL = window.VittCottConfig ? window.VittCottConfig.getAssistantUrl() : 'http://localhost:8501';

    // Elements
    const openHeaderBtn = document.getElementById('open-ai-btn');
    const floatOpenBtn = document.getElementById('float-open');

    // Open the assistant in a full browser tab (with optional prompt query param)
    function openAssistant(promptText = '') {
      let url = ASSISTANT_URL;
      if (promptText) {
        const sep = url.includes('?') ? '&' : '?';
        url = url + sep + 'prompt=' + encodeURIComponent(promptText);
      }
      // open in new tab to avoid iframe embedding issues
      window.open(url, '_blank');
    }

    // convenience: open and inject a prompt
    function openAssistantWithPrompt(promptText='') {
      openAssistant(promptText);
    }

    // wire UI: header and floating buttons open the assistant in a new tab
    if (openHeaderBtn) openHeaderBtn.addEventListener('click', () => openAssistant());
    if (floatOpenBtn) floatOpenBtn.addEventListener('click', () => openAssistant());

    // init feather + AOS + year text after DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
      if (window.feather) feather.replace();
      if (window.AOS) AOS.init({duration:700});
      document.getElementById('year').textContent = new Date().getFullYear();
      
      // Check if user is logged in
      checkAuthStatus();
    });

    // Check authentication status and update UI
    function checkAuthStatus() {
      const token = localStorage.getItem('vittcott_token');
      const userStr = localStorage.getItem('vittcott_user');
      
      const loggedOutBtns = document.getElementById('logged-out-btns');
      const loggedInSection = document.getElementById('logged-in-section');
      const welcomeText = document.getElementById('welcome-text');
      const logoutBtn = document.getElementById('logout-btn');
      
      if (token && userStr) {
        try {
          const user = JSON.parse(userStr);
          const displayName = user.displayName || user.email.split('@')[0];
          
          // Show logged in state
          loggedOutBtns.classList.add('hidden');
          loggedInSection.classList.remove('hidden');
          welcomeText.textContent = `Welcome, ${displayName}!`;
          
          // Wire logout button
          logoutBtn.addEventListener('click', logout);
        } catch (e) {
          console.error('Failed to parse user data:', e);
          showLoggedOut();
        }
      } else {
        showLoggedOut();
      }
    }

    function showLoggedOut() {
      const loggedOutBtns = document.getElementById('logged-out-btns');
      const loggedInSection = document.getElementById('logged-in-section');
      
      loggedOutBtns.classList.remove('hidden');
      loggedInSection.classList.add('hidden');
    }

    function logout() {
      localStorage.removeItem('vittcott_token');
      localStorage.removeItem('vittcott_user');
      alert('Logged out successfully!');
      showLoggedOut();
    }

    // ===== Upload Portfolio Widget Logic =====
    const PRESIGN_URL = 'http://localhost:8000/presign';
    const REGISTER_URL = 'http://localhost:8000/register';

    const openUploadBtn = document.getElementById('open-upload-btn');
    const closeUploadBtn = document.getElementById('close-upload');
    const uploadWidget = document.getElementById('upload-widget');
    const ucUsername = document.getElementById('uc-username');
    const ucFile = document.getElementById('uc-file');
    const ucUploadBtn = document.getElementById('uc-uploadBtn');
    const ucClearBtn = document.getElementById('uc-clearBtn');
    const ucProgress = document.getElementById('uc-progress');
    const ucStatus = document.getElementById('uc-status');

    // Open upload widget
    if (openUploadBtn) {
      openUploadBtn.addEventListener('click', () => {
        uploadWidget.style.display = 'block';
        // Pre-fill username if logged in
        const token = localStorage.getItem('vittcott_token');
        const userStr = localStorage.getItem('vittcott_user');
        if (token && userStr) {
          try {
            const user = JSON.parse(userStr);
            ucUsername.value = user.email.split('@')[0];
          } catch (e) {
            ucUsername.value = '';
          }
        }
      });
    }

    // Close upload widget
    if (closeUploadBtn) {
      closeUploadBtn.addEventListener('click', () => {
        uploadWidget.style.display = 'none';
      });
    }

    // Clear form
    if (ucClearBtn) {
      ucClearBtn.addEventListener('click', () => {
        ucFile.value = '';
        ucProgress.style.display = 'none';
        ucProgress.value = 0;
        ucStatus.textContent = '';
      });
    }

    // Upload file to S3
    if (ucUploadBtn) {
      ucUploadBtn.addEventListener('click', async () => {
        const username = ucUsername.value.trim();
        const file = ucFile.files[0];

        if (!username) {
          ucStatus.textContent = '‚ùå Please enter username';
          ucStatus.style.color = '#ef4444';
          return;
        }
        if (!file) {
          ucStatus.textContent = '‚ùå Please select a file';
          ucStatus.style.color = '#ef4444';
          return;
        }

        try {
          ucStatus.textContent = 'üîÑ Getting presigned URL...';
          ucStatus.style.color = '#cbd5e1';
          ucProgress.style.display = 'block';
          ucProgress.value = 10;

          // Step 1: Get presigned POST from backend
          const presignRes = await fetch(PRESIGN_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              filename: file.name,
              content_type: file.type || 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
              username: username
            })
          });

          if (!presignRes.ok) {
            throw new Error(`Presign failed: ${presignRes.status}`);
          }

          const presignData = await presignRes.json();
          ucProgress.value = 30;
          ucStatus.textContent = '‚òÅÔ∏è Uploading to S3...';

          // Step 2: Upload file to S3 using presigned POST
          const formData = new FormData();
          Object.entries(presignData.fields).forEach(([key, value]) => {
            formData.append(key, value);
          });
          formData.append('file', file);

          const s3Res = await fetch(presignData.url, {
            method: 'POST',
            body: formData
          });

          if (s3Res.status !== 204 && !s3Res.ok) {
            throw new Error(`S3 upload failed: ${s3Res.status}`);
          }

          ucProgress.value = 70;
          ucStatus.textContent = 'üìù Registering file...';

          // Step 3: Register file in backend
          const registerRes = await fetch(REGISTER_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              username: username,
              s3_key: presignData.key,
              filename: file.name,
              size: file.size
            })
          });

          if (!registerRes.ok) {
            console.warn('Registration failed but file uploaded to S3');
          }

          ucProgress.value = 100;
          ucStatus.textContent = '‚úÖ Upload successful!';
          ucStatus.style.color = '#10b981';

          // Clear after 3 seconds
          setTimeout(() => {
            ucFile.value = '';
            ucProgress.style.display = 'none';
            ucProgress.value = 0;
            ucStatus.textContent = '';
          }, 3000);

        } catch (err) {
          console.error('Upload error:', err);
          ucStatus.textContent = `‚ùå Upload failed: ${err.message}`;
          ucStatus.style.color = '#ef4444';
          ucProgress.style.display = 'none';
        }
      });
    }
  </script>

  <script src="/assets/js/app.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
</body>
</html>
<button id="open-upload-btn" class="px-3 py-2 bg-green-600 rounded">Upload Portfolio</button>

<!-- Upload widget (hidden by default) -->
<div id="upload-widget" style="display:none; position:fixed; right:20px; bottom:90px; z-index:60; background:rgba(17,24,39,0.95); padding:18px; border-radius:10px; width:320px; box-shadow:0 10px 30px rgba(0,0,0,0.6);">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
    <strong style="color:#E6EEF8">Upload Portfolio</strong>
    <button id="close-upload" style="background:transparent; color:#cbd5e1; border:none; font-size:16px;">‚úï</button>
  </div>

  <input id="uc-username" placeholder="username" style="width:100%; padding:8px; margin-bottom:8px; border-radius:6px; border:1px solid #374151; background:#0f1724; color:#e5e7eb" value="testuser" />
  <input id="uc-file" type="file" accept=".xlsx,.xls" style="width:100%; margin-bottom:8px; color:#e5e7eb" />
  <div style="display:flex; gap:8px;">
    <button id="uc-uploadBtn" style="flex:1; padding:8px; background:#10B981; color:white; border-radius:6px; border:none;">Upload</button>
    <button id="uc-clearBtn" style="padding:8px; background:#374151; color:#e5e7eb; border-radius:6px; border:none;">Clear</button>
  </div>

  <progress id="uc-progress" value="0" max="100" style="width:100%; margin-top:8px; display:none"></progress>
  <div id="uc-status" style="color:#cbd5e1; margin-top:8px; font-size:13px;"></div>
</div>
